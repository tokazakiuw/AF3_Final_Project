---
title: "Prevention is Better than Cure—Statistical Observations of Cardiovascular Disease Data"
author: "Ty Kentaro Okazaki, Matthew R Herradura, David Xie, Carson Klein"
date: "`r Sys.Date()`"
output: openintro::lab_report
---

```{r load-packages, message=FALSE, echo=FALSE}
library(tidyverse)
library(openintro)
library(infer)
library(broom)
```

```{r load-data, message=FALSE, echo=FALSE}
cms_data <- read.csv("../data/cms_data.csv")

cms_data <- cms_data %>%
## Drop Unnecessary Columns
  select(-c("LocationDesc", "DataSource", "Category", "Data_Value_Type", "Data_Value_Alt", "Data_Value_Footnote_Symbol", "Data_Value_Footnote", "CategoryId", "TopicId", "IndicatorID", "Data_Value_TypeID", "BreakOutCategoryId", "BreakOutId"))
```

## Introduction

Using data gathered from Medicare and Medicaid patients, the Center for Medicare & Medicaid services (CMS) compiles claim data across numerous categorical and numerical variables. Collected from a variety of sources including: hospital databases, diagnostic reports, and surveys whilst adhering to an array of Quality Rating System (QRS) guidelines and requirements, the Center for Medicare & Medicaid services provides reliable and representative data. Computed by personnel in CDC's Division for Heart Disease and Stroke Prevention (DHDSP), furthermore, this [data set](https://chronicdata.cdc.gov/Heart-Disease-Stroke-Prevention/Center-for-Medicare-Medicaid-Services-CMS-Medicare/iw6q-r3ja) provides potential insights on Cardiovascular disease (CVD) indicators and associated risk factors; categorized by variables such as age, race/ethnicity, and location, this data set can be processed and analyzed using statistical methods to highlight insights into CVD prevention. Specifically, this data set includes anonymous CVD hospitalizations data from Medicare & Medicaid patients of age 65+ across the United States. Considering the influences and patterns variables can have with regard to predicting CVD hospitalization instances, it is important to dissect and analyze those of paramount importance. Consequently, our general question(s) are as follows: What are the main factors that influence a patient's susceptibility for developing cardiovascular disease? Is there a significant relationship between specific variables and the prevalence of cardiovascular disease?

[Motivate why topic is interesting and important]

```{r introduction-stats}
## Summarize the mean and median value by Predictor Variables and Percent
variable_stats_percent <- cms_data %>% 
  filter(Data_Value_Unit=="Percent (%)", Indicator=="Prevalence of major cardiovascular disease hospitalizations among all hospitalizations, US Medicare FFS beneficiaries (65+)") %>% 
  filter(!is.na(Break_Out), !is.na(Data_Value)) %>% 
  group_by(Break_Out) %>% 
  summarize(
    mean_value = mean(Data_Value),
    median_value = median(Data_Value),
  )
variable_stats_percent
```

```{r introduction-visualization}
## Histogram plot visualizing the distribution of Data_Value faceted by Break_Out by Rate
faceted_plot_rate <- ggplot(data=cms_data %>% 
                       filter(!is.na(Break_Out), !is.na(Data_Value), Data_Value<40, Data_Value_Unit=="Percent (%)"),
                        mapping=aes(x=Data_Value)) +
                    geom_histogram(binwidth = 2) +
                      facet_wrap(~Break_Out) +
                    labs(title="Distribution of Data_Value for all Years (2004-2013)",
                         subtitle="Faceted by Break_Out (various predictor variables)",
                         x="Data_Value")
faceted_plot_rate
```

[Research questions you will be investigating]

#### Code Book

This data set includes instances of cardiovascular disease (CVD), potential indicators, and associated risk factors for Medicare and Medicaid patients across the United States.

Dimensions of the `cms_data` data frame (after cleaning).

-   Rows/Observations: 42,640

-   Columns/Variables: 16

Print the output of `glimpse` of data frame: `cms_data`

```{r glimpse-data}
glimpse(cms_data)
```

A description of the variables is below:

+-----------------------+---------------------------------------------------------------------------------------------------------------+------------+
| Variable Name         | Description                                                                                                   | Data Type  |
+=======================+===============================================================================================================+============+
| `Year`                | Year                                                                                                          | Number     |
+-----------------------+---------------------------------------------------------------------------------------------------------------+------------+
| `LocationAbbr`        | Location abbreviation                                                                                         | Plain Text |
+-----------------------+---------------------------------------------------------------------------------------------------------------+------------+
| `PriorityArea1`       | Priority Area (Million Hearts® or None)                                                                       | Plain Text |
+-----------------------+---------------------------------------------------------------------------------------------------------------+------------+
| `PriorityArea2`       | Priority Area (ABCS or None)                                                                                  | Plain Text |
+-----------------------+---------------------------------------------------------------------------------------------------------------+------------+
| `PriorityArea3`       | Priority Area (Healthy People 2020 or None)                                                                   | Plain Text |
+-----------------------+---------------------------------------------------------------------------------------------------------------+------------+
| `PriorityArea4`       | Priority Area (AHA 2020 Goals: Cardiovascular Health Metrics or None)                                         | Plain Text |
+-----------------------+---------------------------------------------------------------------------------------------------------------+------------+
| `Topic`               | Topic description                                                                                             | Plain Text |
+-----------------------+---------------------------------------------------------------------------------------------------------------+------------+
| `Indicator`           | Indicator description                                                                                         | Plain Text |
+-----------------------+---------------------------------------------------------------------------------------------------------------+------------+
| `Data_Value_Unit`     | Data Value Unit (%, rate per 100,000, etc.)                                                                   | Plain Text |
+-----------------------+---------------------------------------------------------------------------------------------------------------+------------+
| `Data_Value`          | Data value (point estimate)                                                                                   | Number     |
+-----------------------+---------------------------------------------------------------------------------------------------------------+------------+
| `LowConfidenceLimit`  | 95% confidence interval lower bound                                                                           | Number     |
+-----------------------+---------------------------------------------------------------------------------------------------------------+------------+
| `HighConfidenceLimit` | 95% confidence interval upper bound                                                                           | Number     |
+-----------------------+---------------------------------------------------------------------------------------------------------------+------------+
| `Break_Out_Category`  | Break out category description                                                                                | Plain Text |
+-----------------------+---------------------------------------------------------------------------------------------------------------+------------+
| `Break_Out`           | Break out group description                                                                                   | Plain Text |
+-----------------------+---------------------------------------------------------------------------------------------------------------+------------+
| `LocationId`          | Location lookup value                                                                                         | Plain Text |
+-----------------------+---------------------------------------------------------------------------------------------------------------+------------+
| `GeoLocation`         | Latitude & Longitude to be provided for formatting GeoLocation or Geocode in the format (latitude, longitude) | Location   |
+-----------------------+---------------------------------------------------------------------------------------------------------------+------------+

## Analysis

In this section, we will analyze the data to address various research questions

#### How is race related to Cardiovascular Disease and Hospitalizations?

```{r race-analysis, echo=FALSE}
# filter categories for race 
# filter for NA values
race_data <- cms_data %>%
  filter(Break_Out_Category == "Race", Data_Value_Unit == "Rate per 1,000") %>%
  filter(!is.na(Break_Out), !is.na(Data_Value)) %>%
  group_by(Break_Out) %>%
  summarize(
    mean_value = mean(Data_Value),
    median_value = median(Data_Value),
    iqr_value = IQR(Data_Value),
    sd_value = sd(Data_Value)
  )

race_data

instances <- cms_data %>%
  filter(Break_Out_Category == "Race") %>%
  count(Break_Out)

instances


ggplot(data=cms_data %>% 
                       filter(!is.na(Break_Out), !is.na(Data_Value), Data_Value<100, Break_Out_Category=="Race", Data_Value_Unit=="Rate per 1,000"),
                        mapping=aes(y=Data_Value, x=Break_Out, fill=Break_Out)) +
                    geom_boxplot()
```

```{r race-hist, echo=FALSE}
ggplot(race_data, aes(x = Break_Out, y = mean_value)) + 
  geom_bar(stat = "identity")



ggplot(data=cms_data %>% 
                       filter(!is.na(Break_Out), !is.na(Data_Value), Data_Value_Unit=="Rate per 1,000", Break_Out_Category=="Race"), mapping=aes(x=Data_Value)) +
                    geom_histogram(binwidth = 6) +
                      facet_wrap(~Break_Out) 

```

From looking at preliminary statistics and visuals, relationships between the rate of major cardiovascular disease hospitalizations can be seen among different races in the United States.

#### **Are there differences in Cardiovascular Disease Hospitalizations and Gender (Male vs. Female)?**

An initial summary and visualizations depicting the distribution of cardiovascular disease hospitalizations is shown below.

```{r stat-analysis-gender-1, echo=FALSE}
## Summarize the mean, median, IQR, and sd by Gender and Rate
gender_stats_rate <- cms_data %>% 
  filter(Break_Out_Category == "Gender", Data_Value_Unit=="Rate per 1,000") %>% 
  filter(!is.na(Break_Out), !is.na(Data_Value)) %>% 
  group_by(Break_Out) %>% 
  summarize(
    mean_value = mean(Data_Value),
    median_value = median(Data_Value),
    iqr_value = IQR(Data_Value),
    sd_value = sd(Data_Value)
  )
gender_stats_rate
```

```{r visual-analysis-gender-1, echo=FALSE}
faceted_gender_plot_rate <- ggplot(data=cms_data %>% 
                       filter(!is.na(Break_Out), !is.na(Data_Value), Data_Value<100, Data_Value_Unit=="Rate per 1,000", Break_Out_Category=="Gender"),
                        mapping=aes(x=Data_Value)) +
                    geom_histogram(binwidth = 6) +
                      facet_wrap(~Break_Out) +
                    labs(title="Distribution of Hospitalizations with Heart Failure as the Principal Diagnosis for all Years (2004-2013)",
                         subtitle="Faceted by Gender (Female vs. Male)",
                         x="Hospitalizations with Heart Failure as the Principal Diagnosis")
faceted_gender_plot_rate
```

```{r visual-analysis-gender-2, echo=FALSE}
## Boxplot displaying relationship between gender and Data_Value for all observations (2004-2013) by Rate
gender_boxplot_rate <- ggplot(data=cms_data %>% 
                       filter(!is.na(Break_Out), !is.na(Data_Value), Data_Value<100, Break_Out_Category=="Gender", Data_Value_Unit=="Rate per 1,000"),
                        mapping=aes(y=Data_Value, x=Break_Out, fill=Break_Out)) +
                    geom_boxplot() +
                    labs(title="Comparing relationship between Hospitalizations with Heart Failure as the Principal Diagnosis and Gender",
                         subtitle="All observed data from years: 2004-2013",
                         y="Hospitalizations with Heart Failure as the Principal Diagnosis",
                         x="Gender",
                         fill="Gender")
gender_boxplot_rate
```

Based on these statistics and visualizations depicted above, associations between cardiovascular disease prevalence and predictor variables can be observed. When observing the box plot visualization comparing Female and Male instances of CVD hospitalizations using Data_Value, for example, we see the median Data_Value rate for Males is slightly higher on average with a value of 21.00 when compared to a median Data_Value rate of 17.65 for Females. Consequently, we can ask and answer the following research question using statistical analysis:

**Are Males more Susceptible (in comparison to Females) to Hospitalizations with Heart Failure as the Principal Diagnosis?**

**Null Hypothesis**: Gender has no influence on a patient's susceptibility for cardiovascular disease related hospitalizations.

**Alternative Hypothesis**: Gender will influence a patient's susceptibility for cardiovascular disease related hospitalizations. Specifically, Males will be adversely impacted by cardiovascular disease related hospitalizations in proportion to Females.

In this analysis \_\_

```{r gender-statistical analysis, echo=FALSE}
## Visualize the bootstrap distribution of difference in mean value between Males and Females
## Set seed to 8253
set.seed(8253)

## Calculate 1000 different resamples of data and calculate the difference in mean value between Males and Females
gender_boot_diff_mean <- cms_data %>%
  filter(Break_Out_Category == "Gender", Data_Value_Unit=="Rate per 1,000") %>% 
  filter(!is.na(Break_Out), !is.na(Data_Value)) %>% 
  group_by(Break_Out) %>% 
  specify(Data_Value ~ Break_Out) %>%
  generate(reps = 1000, type = "bootstrap") %>%
  calculate(stat = "diff in means",
  order=c("Male", "Female"))
head(gender_boot_diff_mean)

## Visualize the bootstrap distribution of the difference in mean value between Males and Females
gender_boot_diff_mean %>% 
  visualize()+
  labs(title="1000 bootstraps of the difference in means",
       subtitle="95% confidence interval",
       y="count",
       x="Bootstrapped difference in mean value between Males and Females")

## Give the lower and upper bounds of a 95% bootstrap confidence interval for gender_boot_diff_mean
gender_boot_diff_mean %>% 
  summarize(mean=mean(stat),
            lower=quantile(stat, 0.025),
            upper=quantile(stat, 0.975))
```

Based on the initial histogram depicted above, the distribution and frequency of the bootstrapped proportion of the difference in mean value between Males and Females can be visualized. Using calculations, furthermore, the lower and upper bounds of a 95% bootstrap confidence interval are about 3.4801 and 5.2598 respectively. This illustrates that we are 95% confident that the true parameters (average difference in mean value between Males and Females for hospitalized Medicaid & Medicare patients in 2004-2013, across the US) is within the random bounds 3.4801 and 5.2598.

#### How does geographic location influence Cardiovascular Disease and Hospitalizations?

#### Does age influence Cardiovascular Disease and Hospitalizations?

Data set

```{r summarise-data-age-percentage, echo=FALSE}
## A general analysis and data clean up for comparing relatinship between age and
## Cardiovascular Diseases and Hospitalizations.
age_only <- cms_data %>% 
  filter(Break_Out_Category == "Age", !is.na(Data_Value)) %>% 
  group_by(Topic, Break_Out) %>% 
  summarise(mean_percentage = mean(Data_Value),
            median_percentage = median(Data_Value),
            max_percentage = max(Data_Value),
            min_percentage = min(Data_Value),
            sd_percentage = sd(Data_Value),
            iqr_percentage = IQR(Data_Value)) %>% 
  rename(Age = "Break_Out") %>% 
  arrange(Age)
glimpse(age_only)
```

Graph

```{r topic-vs-age-graph, echo=FALSE}
ggplot(data = age_only, 
       mapping = aes(x = Age, y = mean_percentage, fill = Age)) +
  geom_bar(position = "dodge", stat = "identity") +
  facet_wrap(~ Topic) +
  labs(title = "Mean percentage between different ages",
       subtitle = "among different type of heart diseases")
```

From the graphs, we can see that the difference between each age group are really small for different type of cardiovascular disease, so it will be more appropriate if using permutation, because this method will be focused on discovering if there is an relationship between age and cardiovascular diseases.

```{r linear-modeling, echo=FALSE}
model1 <- lm(Data_Value ~ Topic, data = cms_data)
tidy(model1)

rsquared <- glance(model1) %>% 
  select(r.squared, adj.r.squared)
rsquared
```

## Conclusion
